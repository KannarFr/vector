---
delivery_guarantee: "at-least-once"
event_types: ["log"]
issues_url: https://github.com/timberio/vector/issues?q=is%3Aopen+is%3Aissue+label%3A%22sink%3A+rabbitmq%22
operating_systems: ["linux","macos","windows"]
posts_path: /blog/tags/sink-rabbitmq
sidebar_label: "rabbitmq|[\"log\"]"
source_url: https://github.com/timberio/vector/tree/master/src/sinks/rabbitmq.rs
status: "beta"
title: "rabbitmq sink"
unsupported_operating_systems: []
---

<!--
     THIS FILE IS AUTOGENERATED!

     To make changes please edit the template located at:

     website/docs/reference/sinks/rabbitmq.md.erb
-->

The `rabbitmq` sink [streams](#streaming) [`log`][docs.data-model#log] events to [RabbitMQ][urls.rabbitmq] via the [AMQP 0.91 protocol][urls.amqp_091].

## Configuration

import Tabs from '@theme/Tabs';

<Tabs
  block={true}
  defaultValue="common"
  values={[
    { label: 'Common', value: 'common', },
    { label: 'Advanced', value: 'advanced', },
  ]
}>

import TabItem from '@theme/TabItem';

<TabItem value="common">

import CodeHeader from '@site/src/components/CodeHeader';

<CodeHeader fileName="vector.toml" learnMoreUrl="/docs/setup/configuration"/ >

```toml
[sinks.my_sink_id]
  # REQUIRED - General
  type = "rabbitmq" # example, must be: "rabbitmq"
  inputs = ["my-source-id"] # example
  address = "127.0.0.1:5672/" # example
  routing_key = "bar-key" # example
  
  # REQUIRED - requests
  encoding = "json" # example, enum
  
  # OPTIONAL - General
  exchange = "foo-exchange" # example, no default
  immediate = false # default
  mandatory = false # default
```

</TabItem>
<TabItem value="advanced">

<CodeHeader fileName="vector.toml" learnMoreUrl="/docs/setup/configuration" />

```toml
[sinks.my_sink_id]
  # REQUIRED - General
  type = "rabbitmq" # example, must be: "rabbitmq"
  inputs = ["my-source-id"] # example
  address = "127.0.0.1:5672/" # example
  routing_key = "bar-key" # example
  
  # REQUIRED - requests
  encoding = "json" # example, enum
  
  # OPTIONAL - General
  exchange = "foo-exchange" # example, no default
  healthcheck = true # default
  immediate = false # default
  mandatory = false # default
  sasl_mechanism = "plain" # default, enum
  
  # OPTIONAL - Buffer
  [sinks.my_sink_id.buffer]
    type = "memory" # default, enum
    max_size = 104900000 # example, no default, bytes, relevant when type = "disk"
    num_items = 500 # default, events, relevant when type = "memory"
    when_full = "block" # default, enum
  
  # OPTIONAL - Exchange declare
  [sinks.my_sink_id.exchange_declare]
    # OPTIONAL - General
    auto_delete = false # default
    durable = true # default
    internal = false # default
    kind = "direct" # default, enum
    nowait = false # default
    passive = false # default
    
    # OPTIONAL - Field table
    [sinks.my_sink_id.exchange_declare.field_table]
      my_string_field = "string value"
```

</TabItem>

</Tabs>

## Options

import Fields from '@site/src/components/Fields';

import Field from '@site/src/components/Field';

<Fields filters={true}>


<Field
  common={true}
  defaultValue={null}
  enumValues={null}
  examples={["127.0.0.1:5672/","amqp://guest:guest@127.0.0.1:5672/"]}
  name={"address"}
  nullable={false}
  path={null}
  relevantWhen={null}
  required={true}
  templateable={false}
  type={"string"}
  unit={null}
  >

### address

The address of a target RabbitMQ broker.


</Field>


<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={[]}
  name={"buffer"}
  nullable={true}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"table"}
  unit={null}
  >

### buffer

Configures the sink specific buffer.

<Fields filters={false}>


<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={[104900000]}
  name={"max_size"}
  nullable={true}
  path={"buffer"}
  relevantWhen={{"type":"disk"}}
  required={false}
  templateable={false}
  type={"int"}
  unit={"bytes"}
  >

#### max_size

The maximum size of the buffer on the disk.


</Field>


<Field
  common={false}
  defaultValue={500}
  enumValues={null}
  examples={[500]}
  name={"num_items"}
  nullable={true}
  path={"buffer"}
  relevantWhen={{"type":"memory"}}
  required={false}
  templateable={false}
  type={"int"}
  unit={"events"}
  >

#### num_items

The maximum number of [events][docs.data-model#event] allowed in the buffer.


</Field>


<Field
  common={false}
  defaultValue={"memory"}
  enumValues={{"memory":"Stores the sink's buffer in memory. This is more performant (~3x), but less durable. Data will be lost if Vector is restarted abruptly.","disk":"Stores the sink's buffer on disk. This is less performance (~3x),  but durable. Data will not be lost between restarts."}}
  examples={["memory","disk"]}
  name={"type"}
  nullable={false}
  path={"buffer"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  >

#### type

The buffer's type / location. `disk` buffers are persistent and will be retained between restarts.


</Field>


<Field
  common={false}
  defaultValue={"block"}
  enumValues={{"block":"Applies back pressure when the buffer is full. This prevents data loss, but will cause data to pile up on the edge.","drop_newest":"Drops new data as it's received. This data is lost. This should be used when performance is the highest priority."}}
  examples={["block","drop_newest"]}
  name={"when_full"}
  nullable={false}
  path={"buffer"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  >

#### when_full

The behavior when the buffer becomes full.


</Field>


</Fields>

</Field>


<Field
  common={true}
  defaultValue={null}
  enumValues={{"json":"Each event is encoded into JSON and the payload is represented as a JSON array.","text":"Each event is encoded into text via the `message` key and the payload is new line delimited."}}
  examples={["json","text"]}
  name={"encoding"}
  nullable={false}
  path={null}
  relevantWhen={null}
  required={true}
  templateable={false}
  type={"string"}
  unit={null}
  >

### encoding

The encoding format used to serialize the events before outputting.


</Field>


<Field
  common={true}
  defaultValue={null}
  enumValues={null}
  examples={["foo-exchange"]}
  name={"exchange"}
  nullable={true}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  >

### exchange

The exchange to publish messages to, if left empty uses the default exchange.


</Field>


<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={[]}
  name={"exchange_declare"}
  nullable={true}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"table"}
  unit={null}
  >

### exchange_declare

Optionally declare an exchange once a connection is established.

<Fields filters={false}>


<Field
  common={false}
  defaultValue={false}
  enumValues={null}
  examples={[false,true]}
  name={"auto_delete"}
  nullable={true}
  path={"exchange_declare"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"bool"}
  unit={null}
  >

#### auto_delete

Whether to set the auto delete flag for the declared exchange.


</Field>


<Field
  common={false}
  defaultValue={true}
  enumValues={null}
  examples={[true,false]}
  name={"durable"}
  nullable={true}
  path={"exchange_declare"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"bool"}
  unit={null}
  >

#### durable

Whether to set the durable flag for the declared exchange.


</Field>


<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={[]}
  name={"field_table"}
  nullable={true}
  path={"exchange_declare"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"table"}
  unit={null}
  >

#### field_table

Arbitrary fields to set for the declared exchange.

<Fields filters={false}>


<Field
  common={true}
  defaultValue={null}
  enumValues={null}
  examples={[{"my_string_field":"string value"},{"my_env_var_field":"${ENV_VAR}"},{"my_int_field":1},{"my_float_field":1.2},{"my_bool_field":true},{"my_timestamp_field":"1979-05-27 00:32:00 -0700"},{"my_nested_fields":{"key1":"value1","key2":"value2"}},{"my_list":["first","second","third"]}]}
  name={"`[field-name]`"}
  nullable={false}
  path={"exchange_declare.field_table"}
  relevantWhen={null}
  required={true}
  templateable={false}
  type={"*"}
  unit={null}
  >

##### `[field-name]`

The name of the field to add. Accepts all [supported types][docs.configuration#types].


</Field>


</Fields>

</Field>


<Field
  common={false}
  defaultValue={false}
  enumValues={null}
  examples={[false,true]}
  name={"internal"}
  nullable={true}
  path={"exchange_declare"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"bool"}
  unit={null}
  >

#### internal

Whether to set the internal flag for the declared exchange.


</Field>


<Field
  common={false}
  defaultValue={"direct"}
  enumValues={{"direct":"Delivers messages to queues based on the message routing key","fanout":"Routes messages to all of the queues that are bound to it and the routing key is ignored","headers":"Routes on multiple attributes that are more easily expressed as message headers than a routing key","topic":"Routes messages to one or many queues based on matching a message routing key and the pattern used to bind a queue"}}
  examples={["direct","fanout","headers","topic"]}
  name={"kind"}
  nullable={true}
  path={"exchange_declare"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  >

#### kind

The kind of exchange to declare.


</Field>


<Field
  common={false}
  defaultValue={false}
  enumValues={null}
  examples={[false,true]}
  name={"nowait"}
  nullable={true}
  path={"exchange_declare"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"bool"}
  unit={null}
  >

#### nowait

Whether to set the nowait flag for the declared exchange.


</Field>


<Field
  common={false}
  defaultValue={false}
  enumValues={null}
  examples={[false,true]}
  name={"passive"}
  nullable={true}
  path={"exchange_declare"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"bool"}
  unit={null}
  >

#### passive

Whether to set the passive flag for the declared exchange.


</Field>


</Fields>

</Field>


<Field
  common={false}
  defaultValue={true}
  enumValues={null}
  examples={[true,false]}
  name={"healthcheck"}
  nullable={false}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"bool"}
  unit={null}
  >

### healthcheck

Enables/disables the sink healthcheck upon start. See [Health Checks](#health-checks) for more info.


</Field>


<Field
  common={true}
  defaultValue={false}
  enumValues={null}
  examples={[false,true]}
  name={"immediate"}
  nullable={true}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"bool"}
  unit={null}
  >

### immediate

Whether to set the immediate flag for published messages.


</Field>


<Field
  common={true}
  defaultValue={false}
  enumValues={null}
  examples={[false,true]}
  name={"mandatory"}
  nullable={true}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"bool"}
  unit={null}
  >

### mandatory

Whether to set the mandatory flag for published messages.


</Field>


<Field
  common={true}
  defaultValue={null}
  enumValues={null}
  examples={["bar-key"]}
  name={"routing_key"}
  nullable={false}
  path={null}
  relevantWhen={null}
  required={true}
  templateable={false}
  type={"string"}
  unit={null}
  >

### routing_key

A routing key for messages published to the target exchange.


</Field>


<Field
  common={false}
  defaultValue={"plain"}
  enumValues={{"plain":"Default plain login","external":"Delegate authentication to the transport instead of the RabbitMQ server"}}
  examples={["plain","external"]}
  name={"sasl_mechanism"}
  nullable={true}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  >

### sasl_mechanism

The SASL mechanism to use for authentication.


</Field>


</Fields>

## Output

The `rabbitmq` sink [streams](#streaming) [`log`][docs.data-model#log] events to [RabbitMQ][urls.rabbitmq] via the [AMQP 0.91 protocol][urls.amqp_091].

## How It Works

### Environment Variables

Environment variables are supported through all of Vector's configuration.
Simply add `${MY_ENV_VAR}` in your Vector configuration file and the variable
will be replaced before being evaluated.

You can learn more in the [Environment Variables][docs.configuration#environment-variables]
section.

### Health Checks

Health checks ensure that the downstream service is accessible and ready to
accept data. This check is performed upon sink initialization.
If the health check fails an error will be logged and Vector will proceed to
start.

#### Require Health Checks

If you'd like to exit immediately upon a health check failure, you can
pass the `--require-healthy` flag:

```bash
vector --config /etc/vector/vector.toml --require-healthy
```

#### Disable Health Checks

If you'd like to disable health checks for this sink you can set the[`healthcheck`](#healthcheck) option to `false`.

### Streaming

The `rabbitmq` sink streams data on a real-time
event-by-event basis. It does not batch data.


[docs.configuration#environment-variables]: /docs/setup/configuration#environment-variables
[docs.configuration#types]: /docs/setup/configuration#types
[docs.data-model#event]: /docs/about/data-model#event
[docs.data-model#log]: /docs/about/data-model#log
[urls.amqp_091]: https://www.rabbitmq.com/amqp-0-9-1-reference.html
[urls.rabbitmq]: https://www.rabbitmq.com/
